{% extends 'layouts/login.jinja2' %}
{% import 'macros/form.jinja2' as f with context %}

{% block title %}Plataforma Web{% endblock %}

{% block welcome %}
    <div id="welcome" class="text-center text-white">
        <p><img class="img-fluid" src="{{ url_for('static', filename='images/poder-judicial.png') }}" alt="PJECZ"></p>
        <h3>Plataforma Web</h3>
    </div>
{% endblock %}

{% block firebase_content %}
    <div id="firebase_content" class="text-center">
        <p id="firebase_logged_out" class="text-white">Ingrese con su cuenta de...</p>
        <p id="firebase_logged_in" class="text-white" style="display: none;"><strong>¡Hola <span id="user">____</span>!</strong></p>
        <button id="quickstart-sign-in" disabled class="btn btn-primary py-2">Cargando...</button>
        <p id="quickstart-sign-in-status" class="text-gray"></p>
    </div>
{% endblock %}

{% block acceso_form_content %}
            <div class="form-floating">
                <input type="email" class="form-control" id="floatingInput" placeholder="name@example.com">
                <label for="floatingInput">Email address</label>
            </div>
            <div class="form-floating">
                <input type="password" class="form-control" id="floatingPassword" placeholder="Password">
                <label for="floatingPassword">Password</label>
            </div>
            <div class="checkbox mb-3">
                <label>
                    <input type="checkbox" value="remember-me"> Remember me
                </label>
            </div>
            <button class="w-100 btn btn-lg btn-primary" type="submit">Sign in</button>


    <div id="acceso_form_content">
        {% call f.form_tag('usuarios.login', fid='acceso_form') %}
        <div id="acceso_form_firebase_fields" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <div class="input-group mb-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text bg-success text-white" id="basic-addon1"><i class="fas fa-envelope"></i></span>
                        </div>
                        {% call f.field(form.email, id='email', class='form-control form-control-lg', readonly='readonly') %}{% endcall %}
                    </div>
                    <div class="input-group mb-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text bg-warning text-white" id="basic-addon1"><i class="fas fa-key"></i></span>
                        </div>
                        {% call f.field(form.token, id='token', class='form-control form-control-lg', readonly='readonly') %}{% endcall %}
                    </div>
                </div>
            </div>
        </div>
        <div id="acceso_form_password_fields">
            <div class="py-2 text-center">
                <p class="mb-0 text-white">Ingrese con correo electrónico y contraseña...</p>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="input-group mb-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text bg-success text-white" id="basic-addon1"><i class="ti-user"></i></span>
                        </div>
                        {% call f.field(form.identidad, id='identidad', class='form-control form-control-lg', placeholder='correo electrónico', autofocus='autofocus') %}{% endcall %}
                    </div>
                    <div class="input-group mb-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text bg-warning text-white" id="basic-addon2"><i class="ti-pencil"></i></span>
                        </div>
                        {% call f.field(form.contrasena, id='contrasena', class='form-control form-control-lg', placeholder='contraseña') %}{% endcall %}
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <button class="btn btn-success float-right" type="submit">Accesar</button>
            </div>
        </div>
        {% endcall %}
    </div>
{% endblock %}

{% block custom_javascript %}
    <!-- The core Firebase JS SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-auth.js"></script>
    <script src="{{ url_for('static', filename='js/login.js') }}"></script>
    <script>
        /* Firebase configuracion */
        var firebaseConfig = {
            apiKey: "{{ firebase_auth['apiKey'] }}",
            authDomain: "{{ firebase_auth['authDomain'] }}",
            databaseURL: "{{ firebase_auth['databaseURL'] }}",
            projectId: "{{ firebase_auth['projectId'] }}",
            storageBucket: "{{ firebase_auth['storageBucket'] }}",
            messagingSenderId: "{{ firebase_auth['messagingSenderId'] }}",
            appId: "{{ firebase_auth['appId'] }}",
            measurementId: "{{ firebase_auth['measurementId'] }}"
        };
        /* Al inicio */
        $(document).ready(function() {
            if (firebaseConfig['apiKey'] != "") {
                firebase.initializeApp(firebaseConfig); // Inicializar Firebase
                initApp(); // Cargar eventos de la interfaz
            } else {
                $('#firebase_content').hide(); // No hay configuracion, se oculta
            }
        });
    </script>
{% endblock %}
